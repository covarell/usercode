process Cosmics = {
 
	# service = Tracer {}

        service = MessageLogger { 
		untracked vstring destinations = { "cout" }
		
		untracked PSet cout    = { 
			untracked string threshold = "INFO" 
			untracked bool noLineBreaks = true 
	                        }
	}
	
	# no magnetic field
	include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
	include "MagneticField/Engine/data/uniformMagneticField.cfi"
        es_prefer = UniformMagneticFieldESProducer{}
        replace UniformMagneticFieldESProducer.ZFieldInTesla = 0.0

	# ideal geometry and interface
	include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
        include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
	include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
	
        # Filter clusters    
        module clusterfilter = ClusterFilter {
            string ClusterProducer = "siStripClusters"
            string StripCPE = "StripCPEfromTrackAngle"
            string filterCriteria = "ApproxSectorTest"
        }

        include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitMatcher.cfi"
        include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitConverter.cfi"
        replace siStripMatchedRecHits.ClusterProducer = "clusterfilter"

        # MeasurementTracker
        include "RecoTracker/MeasurementDet/data/MeasurementTrackerESProducer.cfi"
        replace MeasurementTracker.pixelClusterProducer = ""
        replace MeasurementTracker.stripClusterProducer = "clusterfilter" 

        include "RecoTracker/GeometryESProducer/data/TrackerRecoGeometryESProducer.cfi"

        # stripCPE
        include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"
        # pixelCPE
        include "RecoLocalTracker/SiPixelRecHits/data/PixelCPEParmError.cfi"
        # TransientTrackingBuilder
        include "RecoTracker/TransientTrackingRecHit/data/TransientTrackingRecHitBuilder.cfi" 

        # the CosmicSeedFinder
        module cosmicseedfinder= CosmicSeedGenerator {
          InputTag matchedRecHits = siStripMatchedRecHits:matchedRecHit
          InputTag rphirecHits    = siStripMatchedRecHits:rphiRecHit
          InputTag stereorecHits  = siStripMatchedRecHits:stereoRecHit
          double ptMin= 0.9
          double originRadius = 150
          double originHalfLength = 90
          double originZPosition = 0
          string TTRHBuilder        =  "WithTrackAngle"	
          untracked string GeometricStructure  = "STANDARD" //other choice: TIBD+   
       }

        # the CosmicTrackFinder
        module cosmictrackfinder= CosmicTrackFinder { 
          bool TrajInEvents=true
          InputTag cosmicSeeds = cosmicseedfinder:
          InputTag matchedRecHits = siStripMatchedRecHits:matchedRecHit
          InputTag rphirecHits    = siStripMatchedRecHits:rphiRecHit
          InputTag stereorecHits  = siStripMatchedRecHits:stereoRecHit
          string HitProducer        = "siStripRecHits"
          int32 MinHits=4
          double Chi2Cut=1000.
          string TTRHBuilder    =   "WithTrackAngle"
          untracked string GeometricStructure  = "MTCC"
          untracked bool debug = true
        }

        # the CombinatorialTrackFinder
        module combinatorialseedfinder = CombinatorialSeedGeneratorForCosmics {
          InputTag matchedRecHits = siStripMatchedRecHits:matchedRecHit
          InputTag rphirecHits    = siStripMatchedRecHits:rphiRecHit
          InputTag stereorecHits  = siStripMatchedRecHits:stereoRecHit
          double SeedMomentum = 1    #initial momentum in GeV !!!	
          untracked string GeometricStructure  = "CkfTIF3" 
          string Matcher = "StandardMatcher"

          PSet UpperScintillatorParameters = {
            double WidthInX = 500      #half dimension in global X
            double LenghtInZ = 500     #half dimension in global Z	
            double GlobalX = 0         #scintillator's center position in global X
            double GlobalY = 300       #scintillator's center position in global Y
            double GlobalZ = 50        #scintillator's center position in global Z  
           }
          PSet LowerScintillatorParameters = {
            double WidthInX = 500      #half dimension in global X
            double LenghtInZ = 500     #half dimension in global Z
            double GlobalX = 0         #scintillator's center position in global X
            double GlobalY = -100      #scintillator's center position in global Y
            double GlobalZ = 50        #scintillator's center position in global Z
           }
         }

         include "RecoTracker/CkfPattern/data/CkfTrackCandidates.cff"
    
         replace ckfTrackCandidates.TrajectoryBuilder    = "GroupedCkfTrajectoryBuilder"
         replace ckfTrackCandidates.SeedProducer         = "combinatorialseedfinder"
         replace GroupedCkfTrajectoryBuilder.ptCut               = 0.01
         replace GroupedCkfTrajectoryBuilder.maxLostHit          = 3
         replace GroupedCkfTrajectoryBuilder.maxConsecLostHit    = 1
         replace GroupedCkfTrajectoryBuilder.minimumNumberOfHits = 4

         #final fit
         module ctfWithMaterialTracks = TrackProducer {
           string Fitter = "KFFittingSmoother"
           string Propagator = "PropagatorWithMaterial"
           string src = "ckfTrackCandidates"
           string producer = ""
           string TTRHBuilder       =   "WithTrackAngle"
           bool TrajectoryInEvent = true
         }

        #track info
        include "AnalysisAlgos/TrackInfoProducer/data/TrackInfoProducer.cfi"

	# track selection for alignment
	module AlignmentTracks = AlignmentTrackSelectorModule {
		InputTag src = cosmictrackfinder
		bool filter = false
		
		bool applyBasicCuts = true
		double ptMin   = 2. 
		double ptMax   = 999.
		double etaMin  = -2.4
		double etaMax  =  2.4
		double phiMin  = -3.1416
		double phiMax  =  3.1416
		double nHitMin =  3
		double nHitMax = 99
		double chi2nMax= 999999.
		
		bool applyNHighestPt = false
		int32 nHighestPt = 2
		
		bool applyMultiplicityFilter = true
		int32 minMultiplicity = 1
	}
	  
	# input files
	source = PoolSource { 
		
		untracked vstring fileNames = { 
            "file:/data/covarell/inputfiles/Cosmic_TIF_1.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_10.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_100.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_101.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_102.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_103.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_104.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_105.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_106.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_107.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_108.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_109.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_11.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_110.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_111.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_112.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_113.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_114.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_115.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_116.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_117.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_118.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_119.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_120.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_121.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_122.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_123.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_124.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_125.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_126.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_127.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_128.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_129.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_130.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_131.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_132.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_133.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_134.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_135.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_136.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_137.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_138.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_139.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_14.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_140.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_141.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_142.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_143.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_144.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_145.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_146.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_147.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_148.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_149.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_15.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_150.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_151.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_152.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_153.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_154.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_155.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_156.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_157.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_158.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_159.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_16.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_160.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_161.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_162.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_163.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_164.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_165.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_166.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_167.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_168.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_169.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_17.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_170.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_171.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_172.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_173.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_174.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_175.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_176.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_177.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_18.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_19.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_191.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_192.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_193.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_2.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_20.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_21.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_22.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_23.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_24.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_25.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_26.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_27.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_28.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_29.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_3.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_30.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_31.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_32.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_33.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_34.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_35.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_36.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_37.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_38.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_39.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_4.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_40.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_41.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_42.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_43.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_44.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_45.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_46.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_47.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_48.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_49.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_5.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_50.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_51.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_52.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_53.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_54.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_55.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_59.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_6.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_60.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_61.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_62.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_63.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_64.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_65.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_66.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_67.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_68.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_69.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_7.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_70.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_71.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_72.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_73.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_74.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_75.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_76.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_77.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_78.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_79.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_8.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_80.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_81.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_82.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_83.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_84.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_85.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_86.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_87.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_88.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_9.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_92.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_93.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_94.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_95.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_96.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_97.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_98.root",
            "file:/data/covarell/inputfiles/Cosmic_TIF_99.root"

		}
		untracked int32 maxEvents   = -1
		untracked uint32 skipEvents = 0
	
	}	    

       module out = PoolOutputModule 
       {
         untracked string fileName = "/data/covarell/joboutput/CosmicMuonSim_pre5/CosmicMuonSect.root"
       }

	sequence cosmic_track_finder = {cosmicseedfinder,cosmictrackfinder}
        sequence combinatorial_track_finder = {combinatorialseedfinder,ckfTrackCandidates,ctfWithMaterialTracks}
	path p = {clusterfilter,siStripMatchedRecHits,cosmic_track_finder,combinatorial_track_finder,AlignmentTracks }
	
        endpath e = { out }

	# REPLACEME (needed for inserting replace statements by perl script!)

}

